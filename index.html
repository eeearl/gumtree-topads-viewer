<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <script>window.$ = window.jQuery = require('./node_modules/jquery/dist/jquery.min.js');</script>
    <title>Gumtree Top Ads Viewer</title>
  </head>
  <body>
    <button id="search-button">Search</button>

    <div id="result">
    </div>
    
    <script>
      const gumtreeUrl = "http://www.gumtree.com.au/s-vic/pos+system/k0l3008844";
      const reqBtn = $('#search-button');
      var htmlBody, topadsArea, childrenLocationNode, childrenNode, titles=[], locations=[];
      reqBtn.on('click', function() {
        $.ajax({
          url: gumtreeUrl,
        }).done(function(data) {
          htmlBody = $.parseHTML(data);
          topadsArea = $(htmlBody).find('#srchrslt-adtable-topads');
          childrenNode = $(topadsArea).children();
          $(childrenNode).find("a span[itemprop='name']").each(function( n,o){
            titles.push($.trim($(o).text()));
          });
          $(childrenNode).find(".rs-ad-field .rs-ad-location").each(function(n,o) {
            locations.push($(o).text());
          });
          
          var html = $("<ul></ul>");

          $.each(titles, function(n) {
            $(html).append($("<li>" + titles[n] + "," + locations[n] + "</li>"));
          });

          $('#result').append(html);

          console.log(locations);
        });
      });
    </script>
  </body>
</html>
